import{f as u}from"./index-DyGIYi1e.js";const w=async()=>navigator.storage.getDirectory(),f=async(t,o,r=!1)=>t.getDirectoryHandle(o,{create:r}),m=async(t,o,r=!1)=>t.getFileHandle(o,{create:r}),g=async(t,o)=>{try{const r=await o.getDirectoryHandle(t,{create:!1});let i=null;const a=[];for await(const[e,s]of r.entries())if(s.kind==="file"&&e.endsWith(".json"))try{const c=await(await s.getFile()).text(),l=JSON.parse(c),d=new Date(l.date||l.created_at);a.push({id:l.id||e.replace(".json",""),date:d.toISOString()}),(!i||d>i)&&(i=d)}catch(n){console.warn("Failed to read child workout:",n)}return a.sort((e,s)=>new Date(s.date).getTime()-new Date(e.date).getTime()),{lastTrainedAt:i?.toISOString()??null,sessions:a}}catch{return{lastTrainedAt:null,sessions:[]}}},k=async(t,o,r)=>{const a=await(await o.getFile()).text(),e=JSON.parse(a),s=e.id??t.replace(".json",""),{lastTrainedAt:n,sessions:c}=await g(s,r);return{id:s,name:e.name,created_at:e.created_at??new Date().toISOString(),lastTrainedAt:n,sessions:c}},D=async()=>{try{const t=await w(),o=await f(t,"workouts",!0),r=[];for await(const[a,e]of o.entries())if(e.kind==="file"&&a.endsWith(".json")){const n=await k(a,e,o);r.push(n)}return r.sort((a,e)=>{const s=new Date(a.created_at).getTime();return new Date(e.created_at).getTime()-s})}catch(t){return console.error("Failed to read workouts from OPFS:",t),[]}},y=()=>{const[t,{refetch:o}]=u(D);return{workouts:t,refetch:o}};export{f as a,m as b,y as c,w as g};
