import{f as u}from"./index-BDU0uOI0.js";const w=async(r,a)=>{try{const s=await a.getDirectoryHandle(r,{create:!1});let i=null;const e=[];for await(const[t,o]of s.entries())if(o.kind==="file"&&t.endsWith(".json"))try{const c=await(await o.getFile()).text(),d=JSON.parse(c),l=new Date(d.date||d.created_at);e.push({id:d.id||t.replace(".json",""),date:l.toISOString()}),(!i||l>i)&&(i=l)}catch(n){console.warn("Failed to read child workout:",n)}return e.sort((t,o)=>new Date(o.date).getTime()-new Date(t.date).getTime()),{lastTrainedAt:i?.toISOString()??null,sessions:e}}catch{return{lastTrainedAt:null,sessions:[]}}},f=async(r,a,s)=>{const e=await(await a.getFile()).text(),t=JSON.parse(e),o=t.id??r.replace(".json",""),{lastTrainedAt:n,sessions:c}=await w(o,s);return{id:o,name:t.name,created_at:t.created_at??new Date().toISOString(),lastTrainedAt:n,sessions:c}},k=async()=>{try{const a=await(await navigator.storage.getDirectory()).getDirectoryHandle("workouts",{create:!0}),s=[];for await(const[e,t]of a.entries())if(t.kind==="file"&&e.endsWith(".json")){const n=await f(e,t,a);s.push(n)}return s.sort((e,t)=>{const o=new Date(e.created_at).getTime();return new Date(t.created_at).getTime()-o})}catch(r){return console.error("Failed to read workouts from OPFS:",r),[]}},D=()=>{const[r,{refetch:a}]=u(k);return{workouts:r,refetch:a}};export{D as c};
