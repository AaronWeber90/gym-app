import{t as d,i as t,m as te,s as re,c as ae,a as ne,b as le,u as ie,d as se,e as f,f as oe,g as ce,h as a,B as M,S as T,j as U,M as R,F as de,k as V,l as ue}from"./index-BhAKEHLh.js";import{c as he,g as me,a as ge}from"./create-workout-resource-DLYx7usN.js";var we=d('<svg xmlns=http://www.w3.org/2000/svg fill=none viewBox="0 0 24 24"stroke-width=1.5 stroke=currentColor class="h-8 w-8"><path stroke-linecap=round stroke-linejoin=round d="M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0 1 12 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M12 10.875v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125M13.125 12h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125M20.625 12c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5M12 14.625v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 14.625c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m0 1.5v-1.5m0 0c0-.621.504-1.125 1.125-1.125m0 0h7.5"></path><title>table-cells-icon');const ve=()=>we();var fe=d('<div class="flex flex-col gap-1"><input>'),pe=d("<label class=label><span class=label-text>");const A=u=>{const p=ae();return(()=>{var i=fe(),b=i.firstChild;return t(i,(()=>{var g=te(()=>!!u.label);return()=>g()&&(()=>{var w=pe(),$=w.firstChild;return re(w,"for",p),t($,()=>u.label),w})()})(),b),ne(b,le(u,{get type(){return u.type},get class(){return`input w-full ${u.class||""}`},id:p,get value(){return u.value}}),!1,!1),i})()};var be=d('<ul class="list bg-base-100 rounded-box shadow-sm divide-y divide-base-300">'),$e=d('<div class="text-center text-base-content/50 py-8">Keine Übungen vorhanden'),_e=d('<div class="overflow-x-auto w-full max-w-full"><div class="flex flex-row justify-between items-center"><h1 class="text-3xl font-bold"></h1></div><div class=mt-4></div><div><div class="fab fab-overwrite pb-4"><button class="btn btn-lg btn-circle btn-primary"type=button>+'),xe=d('<dialog class="modal modal-open"><div class="modal-box max-w-2xl"><h3 class="font-bold text-lg mb-4">Neue Trainingseinheit</h3><div class="flex flex-col gap-4"></div><div class=modal-action>'),ye=d('<li class="p-3 flex items-center justify-between"><div class="flex items-center gap-3"><div><div class=font-medium></div><div class="text-xs font-semibold opacity-60">started at '),Se=d('<div class="card bg-base-200 shadow-sm"><div class="card-body p-4"><h3 class="font-bold text-lg mb-2"></h3><div class=overflow-x-auto><table class="table table-xs"><thead><tr><th>Satz</th><th>Gewicht</th><th>Whd.</th></tr></thead><tbody>'),De=d('<tr><td></td><td><input type=number min=0 placeholder="Type here"class="input input-ghost input-xs w-20"></td><td><input type=number min=0 placeholder="Type here"class="input input-ghost input-xs w-20">');const Me=()=>{const{workouts:u}=he(),p=ie(),i=se(),[b,g]=f(!1),[w,$]=f(""),[_,x]=f(new Date().toISOString()),[ke,W]=f([{name:"",sets:1,reps:10,weight:0}]),[O,B]=f([]),F=()=>{try{return new Date(_()).toISOString().slice(0,10)}catch{return new Date().toISOString().slice(0,10)}},j=()=>{try{return new Date(_()).toISOString().slice(11,16)}catch{return new Date().toISOString().slice(11,16)}},P=e=>{const r=j(),n=new Date(`${e}T${r}`).toISOString();x(n)},z=e=>{const r=F(),n=new Date(`${r}T${e}`).toISOString();x(n)},J=async()=>{if(!i.id)return[];try{const e=await me(),n=await(await ge(e,"workouts",!0)).getDirectoryHandle(i.id,{create:!1}),s=[];for await(const[o,l]of n.entries())if(l.kind==="file"&&o.endsWith(".json"))try{const h=await(await l.getFile()).text(),c=JSON.parse(h);s.push({id:c.id??o.replace(".json",""),name:c.name??"Unbenannt",date:c.date,created_at:c.created_at})}catch(m){console.warn("Failed to read child workout:",m)}return s.sort((o,l)=>new Date(l.created_at??0).getTime()-new Date(o.created_at??0).getTime())}catch(e){return console.error("Failed to load child workouts:",e),[]}},[y,{refetch:K}]=oe(J),q=async()=>{if(!i.id){alert("Kein Parent-Workout gefunden");return}B([...O()]);try{const n=await(await(await navigator.storage.getDirectory()).getDirectoryHandle("workouts",{create:!0})).getDirectoryHandle(i.id,{create:!0}),s=crypto.randomUUID(),l=await(await n.getFileHandle(`${s}.json`,{create:!0})).createWritable(),m={id:s,parentId:i.id,name:w().trim(),date:new Date(_()).toISOString(),created_at:new Date(_()).toISOString()};await l.write(JSON.stringify(m,null,2)),await l.close(),await K()}catch(e){console.error("Failed to save child workout:",e),alert("Fehler beim Speichern");return}g(!1),$(""),x(new Date().toISOString()),W([{name:"",sets:1,reps:10,weight:0}])},G=()=>{g(!1),$(""),x(new Date().toISOString()),W([{name:"",sets:1,reps:10,weight:0}])},L=ce(()=>{const e=u();if(e)return e.find(r=>r.id===i.id)}),Q=async()=>{try{const r=await(await navigator.storage.getDirectory()).getDirectoryHandle("workouts",{create:!1});try{await r.removeEntry(i.id,{recursive:!0})}catch(n){console.warn("Child workouts directory not found or already deleted:",n)}await r.removeEntry(`${i.id}.json`),p("/workouts")}catch(e){console.error("Failed to delete workout:",e)}};return[a(T,{get when(){return u()},get children(){var e=_e(),r=e.firstChild,n=r.firstChild,s=r.nextSibling,o=s.nextSibling,l=o.firstChild,m=l.firstChild;return t(n,()=>L()?.name),t(r,a(M,{onClick:Q,variant:"ghost",children:"Löschen"}),null),t(s,a(T,{get when(){return y()},get children(){return a(U,{get children(){return a(R,{get when(){return y().length>0},get children(){var h=be();return t(h,a(de,{get each(){return y()},children:c=>(()=>{var S=ye(),v=S.firstChild,D=v.firstChild,k=D.firstChild,C=k.nextSibling;return C.firstChild,t(v,a(ve,{}),D),t(k,()=>new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"2-digit"}).format(new Date(c.date))??""),t(C,()=>new Intl.DateTimeFormat("de-DE",{hour:"2-digit",minute:"2-digit"}).format(new Date(c.date))??"",null),S})()})),h}})}})}})),m.$$click=()=>g(!0),t(o,a(U,{get children(){return a(R,{get when(){return y()?.length<1},get children(){return $e()}})}}),null),t(o,()=>O().map(h=>(()=>{var c=Se(),S=c.firstChild,v=S.firstChild,D=v.nextSibling,k=D.firstChild,C=k.firstChild,X=C.nextSibling;return t(v,()=>h.name),t(X,()=>h.sets.map(I=>(()=>{var E=De(),N=E.firstChild,H=N.nextSibling,Y=H.firstChild,Z=H.nextSibling,ee=Z.firstChild;return t(N,()=>I.set),V(()=>Y.value=I.weight),V(()=>ee.value=I.reps),E})())),c})()),null),e}}),a(T,{get when(){return b()},get children(){var e=xe(),r=e.firstChild,n=r.firstChild,s=n.nextSibling,o=s.nextSibling;return t(s,a(A,{type:"date",label:"Datum",get value(){return F()},onInput:l=>P(l.currentTarget.value)}),null),t(s,a(A,{type:"time",label:"Uhrzeit",get value(){return j()},onInput:l=>z(l.currentTarget.value)}),null),t(o,a(M,{variant:"ghost",onClick:G,children:"Abbrechen"}),null),t(o,a(M,{variant:"primary",onClick:q,type:"submit",children:"Speichern"}),null),e}})]};ue(["click"]);export{Me as default};
